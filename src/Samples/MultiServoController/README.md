# 多舵机机器人控制器

基于 .NET IoT 的多关节舵机控制项目，支持自动角度映射和多舵机同步控制。

## 功能特性

- **自动角度映射**: 输入模型角度，自动转换为舵机实际控制角度
- **多舵机同步控制**: 支持同时控制多个舵机
- **预定义动作**: 内置多种机器人动作（初始化、点头、挥手、旋转）
- **交互式控制**: 支持实时角度调整和动作执行
- **错误处理**: 完善的I2C通信错误处理和重试机制

## 硬件配置

| 关节ID | 名称     | 模型角度范围 | 舵机角度范围 | I2C地址 | 是否反向 |
|--------|----------|-------------|-------------|---------|----------|
| 2      | 头部     | -15° ~ 15°  | 70° ~ 95°   | 0x02    | 是       |
| 4      | 左臂展开 | 0° ~ 30°    | -9° ~ 3°    | 0x04    | 否       |
| 6      | 左臂旋转 | 0° ~ 180°   | -16° ~ 117° | 0x06    | 否       |
| 8      | 右臂展开 | 0° ~ 30°    | 133° ~ 141° | 0x08    | 是       |
| 10     | 右臂旋转 | 0° ~ 180°   | 15° ~ 150°  | 0x0A    | 是       |
| 12     | 底部旋转 | -90° ~ 90°  | 0° ~ 180°   | 0x0C    | 否       |

## 使用方法

### 1. 基本控制

```csharp
using var robot = new RobotController();

// 启用关节
robot.SetJointEnable(2, true);

// 设置模型角度（自动转换为舵机角度）
robot.SetJointModelAngle(2, 10);  // 头部向右10度

// 同时控制多个关节
robot.SetMultipleJointAngles(new Dictionary<int, float>
{
    { 2, 0 },    // 头部居中
    { 4, 15 },   // 左臂展开一半
    { 6, 90 }    // 左臂旋转到中位
});
```

### 2. 预定义动作

```csharp
robot.PerformAction("初始化");  // 所有关节回到初始位置
robot.PerformAction("点头");    // 执行点头动作
robot.PerformAction("挥手");    // 执行挥手动作
robot.PerformAction("旋转");    // 执行底部旋转动作
```

### 3. 交互式控制

运行程序后，可以通过命令行进行实时控制：

```
请输入命令: 2 10          # 将头部设置为10度
请输入命令: action 挥手    # 执行挥手动作
请输入命令: exit          # 退出程序
```

## 角度映射原理

项目实现了模型角度与舵机角度的自动映射：

- **正向映射**: 模型角度增大时，舵机角度增大
- **反向映射**: 模型角度增大时，舵机角度减小（适用于机械结构需要反向的关节）

映射公式：
```
正向: 舵机角度 = (模型角度 - 模型最小) / (模型最大 - 模型最小) * (舵机最大 - 舵机最小) + 舵机最小
反向: 舵机角度 = (模型角度 - 模型最小) / (模型最大 - 模型最小) * (舵机最小 - 舵机最大) + 舵机最大
```

## I2C 通信协议

- **启用/禁用命令**: `0xFF` + 启用标志
- **角度设置命令**: `0x01` + 4字节浮点角度值
- **角度读取命令**: `0x11`

## 依赖项

- .NET 8.0
- System.Device.Gpio
- Verdure.Iot.Device 项目引用

## 运行环境

- 支持 I2C 的设备（如 Raspberry Pi）
- 连接的 ServoF030 舵机控制器
